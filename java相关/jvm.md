# JVM

## JVM 内存空间

1. 程序计数器
2. java虚拟机栈
3. 本地方法栈
4. 堆
5. 方法区

## 程序计数器

### 程序计数器定义

- 较小的内存空间
- **当前线程** 正在执行的字节码的行号指示器
- 程序计数器里面记录的是 **当前线程** 正在执行的那一条字节码指令的地址
- 当前线程正在执行的是一个本地方法，那么此时程序计数器为空

### 程序计数器作用
- 字节码解释器通过改变程序计数器来依次读取指令，从而实现代码的流程控制，如：顺序执行、选择、循环、异常处理
- 在多线程的情况下，程序计数器用于记录当前线程执行的位置，从而当线程被切换回来的时候能够知道该线程上次运行到哪儿了

### 程序计数器特点
- 是一块较小的存储空间
- 线程私有。每条线程都有一个程序计数器。(线程安全)
- 是唯一一个不会出现OutOfMemoryError的内存区域。
- 生命周期随着线程的创建而创建，随着线程的结束而死亡。

## java虚拟机栈(JVM Stack)

### 定义
- Java虚拟机栈是描述Java方法运行过程的内存模型。
- Java虚拟机栈会为每一个即将运行的Java方法创建一块叫做“栈帧”的区域，栈帧中包含局部变量表、操作数栈、动态链接、方法出口信息等

### Java虚拟机栈的特点
1. java虚拟机栈会出现两种异常：StackOverFlowError和OutOfMemoryError。

-  StackOverFlowError表示当前线程申请的栈超过了事先定好的栈的最大深度，但内存空间可能还有很多。
-  OutOfMemoryError是指当线程申请栈时发现栈已经满了，而且内存也全都用光了

2. Java虚拟机栈也是线程私有的，每个线程都有各自的Java虚拟机栈，而且随着线程的创建而创建，随着线程的死亡而死亡。


## 本地方法栈

1.本地方法栈和Java虚拟机栈实现的功能类似，只不过本地方法区是本地方法运行的内存模型。


## 堆

### 定义
1. 堆是用来存放对象的内存空间
2. 细分为新生代和老年代

- 程序新创建的对象都是从新生代分配内存
- 老年代:用于存放经过多次新生代GC仍然存活的对象

### 堆的特点
1. 线程共享
2. 整个Java虚拟机只有一个堆，所有的线程都访问同一个堆。而程序计数器、Java虚拟机栈、本地方法栈都是一个线程对应一个的。
3. 在虚拟机启动时创建
4. 垃圾回收的主要场所。
5. 可以进一步细分为：新生代、老年代。
6. 新生代又可被分为：Eden、From Survior、To Survior。


## 方法区

### 方法区的定义
1.储类信息、常量、静态变量等数据，是线程共享的区域
2. Java虚拟机规范中定义方法区是堆的一个逻辑部分。


### 方法区的特点
1.线程共享
2.方法区是堆的一个逻辑部分，因此和堆一样，都是线程共享的。整个虚拟机中只有一个方法区

